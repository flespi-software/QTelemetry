!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).telemetryVuexModule={})}(this,(function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},r=function(e){return e&&e.Math==Math&&e},n=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof t&&t)||function(){return this}()||Function("return this")(),o={},i=function(e){try{return!!e()}catch(e){return!0}},u=!i((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),c={},a={}.propertyIsEnumerable,f=Object.getOwnPropertyDescriptor,s=f&&!a.call({1:2},1);c.f=s?function(e){var t=f(this,e);return!!t&&t.enumerable}:a;var l=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},p={}.toString,y=function(e){return p.call(e).slice(8,-1)},d=y,h="".split,v=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},g=i((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==d(e)?h.call(e,""):Object(e)}:Object,b=v,m=function(e){return g(b(e))},w=function(e){return"object"==typeof e?null!==e:"function"==typeof e},O=w,j=function(e,t){if(!O(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!O(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!O(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!O(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},S=v,I=function(e){return Object(S(e))},P={}.hasOwnProperty,T=Object.hasOwn||function(e,t){return P.call(I(e),t)},E=w,x=n.document,M=E(x)&&E(x.createElement),k=function(e){return M?x.createElement(e):{}},L=!u&&!i((function(){return 7!=Object.defineProperty(k("div"),"a",{get:function(){return 7}}).a})),_=u,A=c,F=l,N=m,z=j,C=T,D=L,$=Object.getOwnPropertyDescriptor;o.f=_?$:function(e,t){if(e=N(e),t=z(t,!0),D)try{return $(e,t)}catch(e){}if(C(e,t))return F(!A.f.call(e,t),e[t])};var q={},G=w,V=function(e){if(!G(e))throw TypeError(String(e)+" is not an object");return e},W=u,K=L,R=V,Y=j,B=Object.defineProperty;q.f=W?B:function(e,t,r){if(R(e),t=Y(t,!0),R(r),K)try{return B(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var H=q,J=l,Q=u?function(e,t,r){return H.f(e,t,J(1,r))}:function(e,t,r){return e[t]=r,e},U={exports:{}},X=n,Z=Q,ee=function(e,t){try{Z(X,e,t)}catch(r){X[e]=t}return t},te=ee,re="__core-js_shared__",ne=n[re]||te(re,{}),oe=ne,ie=Function.toString;"function"!=typeof oe.inspectSource&&(oe.inspectSource=function(e){return ie.call(e)});var ue=oe.inspectSource,ce=ue,ae=n.WeakMap,fe="function"==typeof ae&&/native code/.test(ce(ae)),se={exports:{}},le=ne;(se.exports=function(e,t){return le[e]||(le[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.14.0",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"});var pe,ye,de,he=0,ve=Math.random(),ge=se.exports,be=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++he+ve).toString(36)},me=ge("keys"),we={},Oe=fe,je=w,Se=Q,Ie=T,Pe=ne,Te=function(e){return me[e]||(me[e]=be(e))},Ee=we,xe="Object already initialized",Me=n.WeakMap;if(Oe||Pe.state){var ke=Pe.state||(Pe.state=new Me),Le=ke.get,_e=ke.has,Ae=ke.set;pe=function(e,t){if(_e.call(ke,e))throw new TypeError(xe);return t.facade=e,Ae.call(ke,e,t),t},ye=function(e){return Le.call(ke,e)||{}},de=function(e){return _e.call(ke,e)}}else{var Fe=Te("state");Ee[Fe]=!0,pe=function(e,t){if(Ie(e,Fe))throw new TypeError(xe);return t.facade=e,Se(e,Fe,t),t},ye=function(e){return Ie(e,Fe)?e[Fe]:{}},de=function(e){return Ie(e,Fe)}}var Ne={set:pe,get:ye,has:de,enforce:function(e){return de(e)?ye(e):pe(e,{})},getterFor:function(e){return function(t){var r;if(!je(t)||(r=ye(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}},ze=n,Ce=Q,De=T,$e=ee,qe=ue,Ge=Ne.get,Ve=Ne.enforce,We=String(String).split("String");(U.exports=function(e,t,r,n){var o,i=!!n&&!!n.unsafe,u=!!n&&!!n.enumerable,c=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof t||De(r,"name")||Ce(r,"name",t),(o=Ve(r)).source||(o.source=We.join("string"==typeof t?t:""))),e!==ze?(i?!c&&e[t]&&(u=!0):delete e[t],u?e[t]=r:Ce(e,t,r)):u?e[t]=r:$e(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&Ge(this).source||qe(this)}));var Ke=n,Re=n,Ye=function(e){return"function"==typeof e?e:void 0},Be={},He=Math.ceil,Je=Math.floor,Qe=function(e){return isNaN(e=+e)?0:(e>0?Je:He)(e)},Ue=Qe,Xe=Math.min,Ze=Qe,et=Math.max,tt=Math.min,rt=m,nt=function(e){return e>0?Xe(Ue(e),9007199254740991):0},ot=function(e,t){var r=Ze(e);return r<0?et(r+t,0):tt(r,t)},it=function(e){return function(t,r,n){var o,i=rt(t),u=nt(i.length),c=ot(n,u);if(e&&r!=r){for(;u>c;)if((o=i[c++])!=o)return!0}else for(;u>c;c++)if((e||c in i)&&i[c]===r)return e||c||0;return!e&&-1}},ut={includes:it(!0),indexOf:it(!1)},ct=T,at=m,ft=ut.indexOf,st=we,lt=function(e,t){var r,n=at(e),o=0,i=[];for(r in n)!ct(st,r)&&ct(n,r)&&i.push(r);for(;t.length>o;)ct(n,r=t[o++])&&(~ft(i,r)||i.push(r));return i},pt=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype");Be.f=Object.getOwnPropertyNames||function(e){return lt(e,pt)};var yt={};yt.f=Object.getOwnPropertySymbols;var dt=Be,ht=yt,vt=V,gt=function(e,t){return arguments.length<2?Ye(Ke[e])||Ye(Re[e]):Ke[e]&&Ke[e][t]||Re[e]&&Re[e][t]}("Reflect","ownKeys")||function(e){var t=dt.f(vt(e)),r=ht.f;return r?t.concat(r(e)):t},bt=T,mt=gt,wt=o,Ot=q,jt=i,St=/#|\.prototype\./,It=function(e,t){var r=Tt[Pt(e)];return r==xt||r!=Et&&("function"==typeof t?jt(t):!!t)},Pt=It.normalize=function(e){return String(e).replace(St,".").toLowerCase()},Tt=It.data={},Et=It.NATIVE="N",xt=It.POLYFILL="P",Mt=It,kt=n,Lt=o.f,_t=Q,At=U.exports,Ft=ee,Nt=function(e,t){for(var r=mt(t),n=Ot.f,o=wt.f,i=0;i<r.length;i++){var u=r[i];bt(e,u)||n(e,u,o(t,u))}},zt=Mt,Ct=y,Dt=Array.isArray||function(e){return"Array"==Ct(e)},$t=[].reverse,qt=[1,2];(function(e,t){var r,n,o,i,u,c=e.target,a=e.global,f=e.stat;if(r=a?kt:f?kt[c]||Ft(c,{}):(kt[c]||{}).prototype)for(n in t){if(i=t[n],o=e.noTargetGet?(u=Lt(r,n))&&u.value:r[n],!zt(a?n:c+(f?".":"#")+n,e.forced)&&void 0!==o){if(typeof i==typeof o)continue;Nt(i,o)}(e.sham||o&&o.sham)&&_t(i,"sham",!0),At(r,n,i,e)}})({target:"Array",proto:!0,forced:String(qt)===String(qt.reverse())},{reverse:function(){return Dt(this)&&(this.length=this.length),$t.call(this)}}),e.default=function(e,t){return{namespaced:!0,state:{deviceId:null,telemetry:{},isLoading:!1,updateIntervalId:0},actions:{update:async function({state:e,commit:r}){try{if(e.deviceId&&!Object.keys(e.telemetry).length){e.isLoading=!0;let n=[],o=()=>{n.forEach((e=>{let t=e.topic,n=e.payload,o=t.split("/").reverse()[0];if("position"===o)return!1;let i=n.toString(),u=e.properties&&e.properties.userProperties&&e.properties.userProperties.timestamp;r("setParameter",{[o]:{value:i,ts:u}})})),n=[]};await t.connector.socket.subscribe({name:`flespi/state/gw/devices/${e.deviceId}/telemetry/+`,handler(e,t,r){n.push(r)}}),e.updateIntervalId=setInterval(o,500),e.isLoading=!1}}catch(e){r("reqFailed",e,{root:!0})}},unsubscribe:async function({state:e,commit:r}){clearInterval(e.updateIntervalId),t.connector.socket.unsubscribe(`flespi/state/gw/devices/${e.deviceId}/telemetry/+`)}},mutations:{init(e,r){t.set(e,"deviceId",r.id||0),t.set(e,"telemetry",r.telemetry||{})},setParameter(e,r){Object.keys(r).forEach((n=>{(!e.telemetry[n]||e.telemetry[n]&&e.telemetry[n].ts<=r[n].ts)&&t.set(e.telemetry,n,r[n])}))},clear(e){t.connector.socket.unsubscribe(`flespi/state/gw/devices/${e.deviceId}/telemetry/+`),t.set(e,"telemetry",{}),t.set(e,"deviceId",null)}}}},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=telemetryVuexModule.js.map
